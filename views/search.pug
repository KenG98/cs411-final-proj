html
	head
		title Search
		link(rel='stylesheet', href='/css/style.css')       
	body
		include ./navbar.pug
		hr
		h1 Find a Movie
		form
			input(type='text', class='search', id='search-field')
			button(type='button', class='button', id='search-button', onclick='doSearch()')= "Search"
		if searchresult
			each movie in searchresult 
				div(class='movie-info')
					div(class='movie-poster')
						img(src=movie.Poster, alt='Movie Poster')
					div(class='movie-details')
						h3 Title
						p= movie.Title
						h3 Year
						p= movie.Year
						p
							button(
								type='button',
								class='button',
								id='watch-list-button',
								onclick='addToWatchList("'+movie.Title+'","'+movie.imdbID+'")'
							)= "Add to Watch List"
						p
							button(
								type='button',
								class='button',
								id='seen-button',
								onclick='addToSeenList("'+movie.Title+'","'+movie.imdbID+'")'
							)= "I've seen this"
						//- these two fields are not shown in the fuzzy search:
						//- h3 Genre
						//- p #{movie.Genre}
						//- h3 Director
						//- p #{movie.Director}
		script.
			function doSearch() {
				let moviename = document.getElementById('search-field').value
				location.href = "/search?moviename=" + moviename
			}
		if user
			script.	
				function addToWatchList(movieTitle, movieID) {
					console.log("Add to watch list", movieTitle, movieID)
					$.get("/api/addToWatchList?movieName=" + movieTitle + "&movieID=" + movieID, (data) => {
						console.log("Request is done. Returned:", data)
					})
					
				}
				function addToSeenList(movieTitle, movieID) {
					console.log("Add to seen list", movieTitle, movieID)
					$.get("/api/addSeenMovie?movieName=" + movieTitle + "&movieID=" + movieID, (data) => {
						console.log("Request is done. Returned:", data)
					})
				}
		else 
			script.
				function addToWatchList(movieTitle, movieID) { alert("Please log in to do that.") }
				function addToSeenList(movieTitle, movieID) { alert("Please log in to do that.") }
		script(src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js")


